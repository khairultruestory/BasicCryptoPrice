<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Price Comparison Across DEXes</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .best-price {
            background-color: #90EE90;
        }
    </style>
</head>
<body>
    <h1>Cryptocurrency Price Comparison Across DEXes</h1>
    <table id="cryptoTable">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Symbol</th>
                <th>CoinGecko Price</th>
                <th>Uniswap V3</th>
                <th>PancakeSwap V2</th>
                <th>SushiSwap</th>
                <th>Curve</th>
                <th>Balancer V2</th>
            </tr>
        </thead>
        <tbody id="cryptoData">
            <!-- Data will be inserted here by JavaScript -->
        </tbody>
    </table>

    <script>
        const API_BASE_URL = 'https://api.coingecko.com/api/v3';
        const DEX_IDS = ['uniswap_v3', 'pancakeswap_v2', 'sushiswap', 'curve', 'balancer_v2'];

        async function fetchTop20Cryptocurrencies() {
            const response = await fetch(`${API_BASE_URL}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false`);
            return await response.json();
        }

async function fetchDEXPrices(coinId) {
    const prices = {};
    try {
        const response = await fetch(`${API_BASE_URL}/coins/${coinId}/tickers?include_exchange_logo=false&order=volume_desc&depth=true`);
        const data = await response.json();
14        
15        DEX_IDS.forEach(dexId => {
16            const dexData = data.tickers.find(ticker => 
17                ticker.market.identifier.toLowerCase().includes(dexId) && 
18                ticker.target === 'USD'
19            );
20            prices[dexId] = dexData ? `$${dexData.last.toFixed(4)}` : 'N/A';
21        });
22    } catch (error) {
23        console.error(`Error fetching DEX prices for ${coinId}:`, error);
24        DEX_IDS.forEach(dexId => {
25            prices[dexId] = 'Error';
26        });
27    }
28    return prices;
29}

        31async function populateTable() {
32    const tableBody = document.getElementById('cryptoData');
33    tableBody.innerHTML = ''; // Clear existing data
34    const cryptocurrencies = await fetchTop20Cryptocurrencies();
35
36    for (let i = 0; i < cryptocurrencies.length; i++) {
37        const crypto = cryptocurrencies[i];
38        const row = tableBody.insertRow();
39        row.insertCell(0).textContent = i + 1;
40        row.insertCell(1).textContent = crypto.name;
41        row.insertCell(2).textContent = crypto.symbol.toUpperCase();
42        row.insertCell(3).textContent = `$${crypto.current_price}`;
43
44        const dexPrices = await fetchDEXPrices(crypto.id);
45        DEX_IDS.forEach((dexId, index) => {
46            row.insertCell(4 + index).textContent = dexPrices[dexId];
47        });

        highlightBestPrice(row);
    }
}

        function highlightBestPrice(row) {
            let bestPrice = Infinity;
            let bestPriceIndex = -1;

            for (let i = 4; i < 9; i++) {
                const priceText = row.cells[i].textContent;
                const price = priceText === 'N/A' || priceText === 'Error' ? Infinity : parseFloat(priceText.replace('$', ''));
                if (price < bestPrice) {
                    bestPrice = price;
                    bestPriceIndex = i;
                }
            }

            if (bestPriceIndex !== -1) {
                row.cells[bestPriceIndex].classList.add('best-price');
            }
        }



        // Initialize the table
        populateTable();

        // Periodically update prices (every 5 minutes to respect API rate limits)
        setInterval(populateTable, 300000);
    </script>
</body>
</html>
